<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SAMU - Ingreso y Turno</title> 
<link rel="stylesheet" href="styles.css" />
</head>
<body>

<h2>Ingreso de Datos SAMU</h2>

<div id="formulario">
  <label for="nombre">Nombre:</label><br/>
  <input type="text" id="nombre" placeholder="Tu nombre" /><br/>

  <label for="apellido">Apellido:</label><br/>
  <input type="text" id="apellido" placeholder="Tu apellido" /><br/>

  <label for="placa">Placa:</label><br/>
  <input type="text" id="placa" placeholder="Número de placa" /><br/>

  <label for="contrasena">Contraseña:</label><br/>
  <input type="password" id="contrasena" placeholder="Contraseña maestra" /><br/>

  <button id="btnIngresar">Ingresar y Guardar</button>
  <p id="mensaje" style="color:red;"></p>
</div>

<div id="datosPersonales" style="display:none;">
  <h2>Datos Guardados</h2>
  <div id="infoDatos"></div>

  <div id="timer">00:00:00</div>

  <div id="controles">
    <button id="btnIniciar">Iniciar</button>
    <button id="btnPausar" disabled>Pausar</button>
    <button id="btnTerminar" disabled>Terminar</button>
  </div>
</div>

<script>
  // CONFIGURA ESTO:
  const CONTRASENAS_MAESTRAS = ['gaT_bsZ2PblA', 'Rb!RlAryrUEn', 'xh(4KeeIna8I', 'QaQNmActyMLA', '!a^nZmlj$#28'];
  const WEBHOOK_URL = 'https://discord.com/api/webhooks/1339641639672741928/odXGMXa6wkkDk3ptjMl4176NOL7rM0zFO1hyCJIxsk3f6mCFflDsld8r3i9AMAhC2019';

  const btnIngresar = document.getElementById('btnIngresar');
  const mensaje = document.getElementById('mensaje');
  const formulario = document.getElementById('formulario');
  const datosPersonales = document.getElementById('datosPersonales');
  const infoDatos = document.getElementById('infoDatos');

  const btnIniciar = document.getElementById('btnIniciar');
  const btnPausar = document.getElementById('btnPausar');
  const btnTerminar = document.getElementById('btnTerminar');
  const timerDisplay = document.getElementById('timer');

  let segundos = 0;
  let intervalo = null;
  let pausado = false;

  function tiempoFormateado(s) {
    const hrs = String(Math.floor(s / 3600)).padStart(2, '0');
    const min = String(Math.floor((s % 3600) / 60)).padStart(2, '0');
    const seg = String(s % 60).padStart(2, '0');
    return `${hrs}:${min}:${seg}`;
  }

  function actualizarTimer() {
    if (!pausado) {
      segundos++;
      timerDisplay.textContent = tiempoFormateado(segundos);
    }
  }

  function mostrarDatos(datos) {
    infoDatos.innerHTML = `
      <strong>Nombre:</strong> ${datos.nombre}<br/>
      <strong>Apellido:</strong> ${datos.apellido}<br/>
      <strong>Placa:</strong> ${datos.placa}<br/>
      <strong>Contraseña:</strong> ${'*'.repeat(datos.contrasena.length)}
    `;
  }

  function enviarWebhook(datos, tiempo) {
    if (!WEBHOOK_URL || WEBHOOK_URL.includes('tu_webhook')) return;

    fetch(WEBHOOK_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        content: `**Turno terminado**\nNombre: ${datos.nombre}\nApellido: ${datos.apellido}\nPlaca: ${datos.placa}\nTiempo trabajado: ${tiempo}`
      })
    });
  }

  btnIngresar.onclick = () => {
    const nombre = document.getElementById('nombre').value.trim();
    const apellido = document.getElementById('apellido').value.trim();
    const placa = document.getElementById('placa').value.trim();
    const contrasena = document.getElementById('contrasena').value.trim();

    if (!nombre || !apellido || !placa || !contrasena) {
      mensaje.textContent = 'Por favor, completa todos los campos.';
      return;
    }

    if (!CONTRASENAS_MAESTRAS.includes(contrasena)) {
      mensaje.textContent = 'Contraseña incorrecta.';
      return;
    }

    mensaje.textContent = '';
    const datos = { nombre, apellido, placa, contrasena };

    mostrarDatos(datos);
    formulario.style.display = 'none';
    datosPersonales.style.display = 'block';

    segundos = 0;
    timerDisplay.textContent = '00:00:00';
    pausado = false;

    btnIniciar.disabled = false;
    btnPausar.disabled = true;
    btnTerminar.disabled = true;

    // Guardar datos para enviar luego
    btnTerminar.datosUsuario = datos;
  };

  btnIniciar.onclick = () => {
    if (intervalo) clearInterval(intervalo);
    pausado = false;
    intervalo = setInterval(actualizarTimer, 1000);

    btnIniciar.disabled = true;
    btnPausar.disabled = false;
    btnTerminar.disabled = false;
  };

  btnPausar.onclick = () => {
    pausado = true;
    btnIniciar.disabled = false;
    btnPausar.disabled = true;
  };

  btnTerminar.onclick = () => {
    if (intervalo) clearInterval(intervalo);

    btnIniciar.disabled = true;
    btnPausar.disabled = true;
    btnTerminar.disabled = true;

    const datos = btnTerminar.datosUsuario;
    const tiempo = tiempoFormateado(segundos);

    enviarWebhook(datos, tiempo);

    alert(`Turno terminado.\nTiempo trabajado: ${tiempo}`);

    // Resetear
    formulario.style.display = 'block';
    datosPersonales.style.display = 'none';
    document.getElementById('nombre').value = '';
    document.getElementById('apellido').value = '';
    document.getElementById('placa').value = '';
    document.getElementById('contrasena').value = '';
    mensaje.textContent = '';
    timerDisplay.textContent = '00:00:00';
  };
</script>

</body>
</html>
